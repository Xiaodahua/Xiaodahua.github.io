---
title: Ajax跨域 
cover_picture: https://i.imgur.com/Laq4KMp.jpg 
date:
categories: ajax
tags: ajax
---
##  ![](https://i.imgur.com/UgkfBYl.jpg) ##
由于浏览器实现的同源策略的限制，XmlHttpRequest只允许请求当前源（域名、协议、端口）的资源，所以AJAX是不允许跨域的。这里提供自己常用的三种方法：

### 1、jsonp访问 ###
 　　JSONP(JSON with Padding)是一个非官方的协议，它允许在服务器端集成Script tags返回至客户端，通过javascript callback的形式实现跨域访问； 实现方式
 1).
![](https://i.imgur.com/ARRl4uq.png)
     *
 2).
 ![](https://i.imgur.com/FVmjfn9.png)
### 2、domain 方法 ###
在主域相同，子域不同的情况下可以用这种方法，修改域名指向，让他们指向同一域名，这种办法也只能解决主域相同而二级域名不同的情况，两个毫无关系的网址是不可以用这种方法的；
 ![](https://i.imgur.com/B0JwS6N.png)
  注：在实际开发中，很多人会在本地调试接口，localhost的域名和公司的域名完全不一样，所有用了domain这种办法也无法产生效果，解决办法是修改c盘里的host文件，把本地地址localhost修改成公司域名或者公司二级域名，然后这种方法就可以使用了。
          下面是修改的域名指向：
          #127.0.0.1  localhost
          127.0.0.1   公司.com
### 3、postMessage ###
　　postMessage是h5的一个新功能之一，方便数据提交等。
   这里假设，iframe的Id为 ‘iframe'；
![](https://i.imgur.com/XPHrzqp.png)
 在ifame外面的js里面要写上
![](https://i.imgur.com/IwCxXO3.png)
###  4、CORS  ###
如果浏览器支持HTML5，那么就可以一劳永逸地使用新的跨域策略：CORS了。

CORS全称Cross-Origin Resource Sharing，是HTML5规范定义的如何跨域访问资源。

了解CORS前，我们先搞明白概念：

Origin表示本域，也就是浏览器当前页面的域。当JavaScript向外域（如sina.com）发起请求后，浏览器收到响应后，首先检查Access-Control-Allow-Origin是否包含本域，如果是，则此次跨域请求成功，如果不是，则请求失败，JavaScript将无法获取到响应的任何数据。
![](https://i.imgur.com/0pBBoTm.png)
假设本域是my.com，外域是sina.com，只要响应头Access-Control-Allow-Origin为http://my.com，或者是*，本次请求就可以成功。

可见，跨域能否成功，取决于对方服务器是否愿意给你设置一个正确的Access-Control-Allow-Origin，决定权始终在对方手中。

上面这种跨域请求，称之为“简单请求”。简单请求包括GET、HEAD和POST（POST的Content-Type类型
仅限application/x-www-form-urlencoded、multipart/form-data和text/plain），并且不能出现任何自定义头（例如，X-Custom: 12345），通常能满足90%的需求。

无论你是否需要用JavaScript通过CORS跨域请求资源，你都要了解CORS的原理。最新的浏览器全面支持HTML5。在引用外域资源时，除了JavaScript和CSS外，都要验证CORS。
 
